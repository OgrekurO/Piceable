
# 项目名称

Eagle Ontology Manager（图像本体管理器）

⸻

# 一、项目概述

## 1.1 背景与目标

Eagle 是一款强大的本地素材管理工具，已具备完善的图片存储、索引、预览、分类、标签与搜索功能。但其现有标签体系多为“平面型”，难以表达复杂的语义关系（如层级属性、父子结构、本体关联）。

Eagle Ontology Manager 插件旨在：

在 Eagle 素材库之上构建一套可视化的“图像属性本体编辑系统”，
让用户在熟悉的 Eagle 环境中，以层级化、表格化方式管理图片语义属性，
支持导出、同步与数据可视化扩展。

⸻

# 二、系统结构

## 2.1 核心模块

模块 功能说明
🧩 文件读取模块 通过 Eagle API 获取当前素材库所有图片及其元数据（名称、路径、标签、注释、文件夹）
🧭 属性映射模块 将文件夹层级、标签结构、注释内容映射为“属性层级”
🧮 属性表格模块 前端表格界面（支持图片预览、名称编辑、属性层级编辑、多级表头）
🔄 同步模块 用户修改图片名称、属性后，一键同步到 Eagle 数据库
📤 导出模块 支持导出 CSV、JSON 格式（可选同步外部数据库）
🧱 配置模块 用户定义属性模板、层级结构、显示顺序等
📊 可视化模块（拓展） 基于属性生成 D3.js 关系网络、层级树等

⸻

# 三、功能需求

## 3.1 图片读取与预览

功能 描述 说明
获取素材库 插件启动后读取当前 Eagle Library 中所有图片数据 使用 eagle.getAllItems()
读取字段 包括：id, name, folders, tags, annotation, url, lastModified 
图片预览 在表格第一列显示缩略图（Eagle 已缓存） 
数据缓存 本地缓存读取结果，加快启动速度 

⸻

## 3.2 属性结构与层级映射

功能 描述 示例
文件夹映射为层级属性 Eagle 文件夹结构自动转换为属性树 /自然/动物/猫 → 内容层级：自然→动物→猫
标签映射为扁平属性 标签作为补充字段 ["建筑", "桥梁"]
用户自定义层级 用户可添加“主题”、“媒介”、“语境”等属性 多行表头形式展示
属性层级可折叠显示 父子层标题，点击可折叠 支持多级

⸻

## 3.3 表格编辑与交互

功能 描述 技术说明
可编辑表格 每行对应一张图片，每列为属性 使用 Tabulator.js / Vue Table
图片名称可修改 修改后点击“同步”可写回 Eagle 通过 updateItemMetadata()
属性可编辑 文本输入、多选下拉、层级树输入 
批量编辑 多选后批量更改属性值 
搜索与过滤 根据属性值或文件夹过滤 
添加列/属性 可动态添加属性字段 

⸻

## 3.4 同步功能

功能 描述 实现方式
同步名称 修改文件名 → Eagle 自动更新文件 API 写入 item.name
同步属性 更新属性字段写回 metadata 插入到 item.annotation 或自定义键
同步状态提示 成功 / 失败弹窗提示 Toast UI
自动备份 同步前导出备份 JSON 防止数据丢失

⸻

## 3.5 数据导出与持久化

输出方式 描述 格式示例
导出 CSV 可供外部处理或分析 每行对应图片，列为属性
导出 JSON 包含层级信息与元数据 支持嵌套结构
写入 SQLite（扩展） 可选后端本地数据库 用于后续可视化分析
导入 CSV 支持批量导入修改 对应 Eagle ID

⸻

## 3.6 属性模板系统（可选）

功能 描述
预设模板 如“内容维度（自然/社会/文化/政治/经济）”
自定义模板 用户自定义层级字段结构
模板应用 对选定图片批量应用模板结构

⸻

## 3.7 可视化扩展（未来版本）

功能 描述
属性网络图 通过 D3.js 展示属性间关系
层级树状图 展示图片属性的层级分布
时间轴视图 若属性含时间字段，生成时间轴
地理映射 若属性含坐标字段，可用地图展示

⸻

四、数据结构定义

4.1 核心数据模型（JSON）

{
  "id": "d29f6d1a-7b31-44c7-aeab-8c2b5d82f8e9",
  "name": "cat.png",
  "path": "/自然/动物/猫/",
  "tags": ["自然", "动物", "猫"],
  "annotation": "灰色猫，来源于网络",
  "customAttributes": {
    "内容": {
      "一级": "自然",
      "二级": "动物",
      "三级": "猫"
    },
    "语境": {
      "时间": "19世纪",
      "地点": "英国"
    }
  }
}

⸻

五、技术架构

5.1 架构图（逻辑）

┌───────────────────────────────┐
│          Eagle App            │
│ ┌───────────────────────────┐ │
│ │   Eagle Ontology Manager  │ │
│ │   (插件: HTML + JS + CSS) │ │
│ └───────────────────────────┘ │
│     ↑               ↓         │
│ Eagle JS API   metadata.json  │
└───────────────────────────────┘
           ↓           ↓
     CSV / JSON   SQLite (扩展)
           ↓
     可视化分析（D3 / Web）

⸻

5.2 技术栈

模块 技术 说明
插件框架 Eagle Plugin System 基于 JS/HTML，本地运行
前端框架 Vue3 / Tabulator.js 构建动态表格界面
数据导出 Papaparse / json2csv CSV 转换
数据存储 metadata.json / SQLite 可双向更新
可视化 D3.js / ECharts（扩展） 后续模块

⸻

六、用户界面（UI）草图

┌──────────────────────────────────────────────────────────┐
│ [选择属性模板] [导出CSV] [同步到Eagle] [刷新]            │
├──────────────────────────────────────────────────────────┤
│ 预览 | 名称   | 内容:一级 | 内容:二级 | 语境:时间 | 来源 │
│──────┼────────┼──────────┼──────────┼──────────┼──────│
│ 🖼️   | cat.png | 自然     | 动物      | 19世纪    | 网络 │
│ 🖼️   | bridge.jpg | 社会 | 建筑      | 20世纪    | 摄影 │
└──────────────────────────────────────────────────────────┘

⸻

七、开发阶段划分

阶段 目标 输出
阶段 1 插件框架搭建，读取 Eagle 数据 可显示所有图片和基本信息
阶段 2 表格编辑与同步功能 可修改名称与属性并写回
阶段 3 CSV 导出 / 导入功能 可生成 CSV 文件
阶段 4 属性模板系统 可定义与应用自定义层级
阶段 5 数据可视化模块 D3.js 层级关系展示
阶段 6 数据库扩展与 AI 标签生成 高级功能与智能标注

⸻

八、未来扩展方向
 • 与本体建模工具（如 Protégé）交互；
 • 使用 CLIP / BLIP 模型自动生成图像语义标签；
 • 将图像属性导入 Neo4j 等图数据库；
 • 多用户协作属性标注（Web 端同步 Eagle 数据）。

⸻

是否希望我帮你把这份需求文档补充成项目结构目录（文件 + 代码骨架）？
可以直接生成一个可运行的 Eagle 插件初版，含：
 • manifest.json
 • index.html
 • js/plugin.js（读取与展示数据）
